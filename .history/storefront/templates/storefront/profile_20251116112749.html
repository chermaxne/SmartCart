{% extends "storefront/base.html" %}
{% load static %}

{% block title %}My Profile{% endblock %}

{% block extra_css %}
<style>
  body {
    background: linear-gradient(135deg, #e8ecff 0%, #f5f0ff 100%);
    min-height: 100vh;
  }

  .profile-layout {
    display: flex;
    max-width: 100%;
    margin: 0;
    padding: 30px 20px;
    gap: 30px;
  }

  /* Sidebar */
  .profile-sidebar {
    width: 220px;
    flex-shrink: 0;
  }

  .sidebar-nav {
    background: white;
    border-radius: 16px;
    padding: 15px;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.1);
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 16px;
    border-radius: 12px;
    text-decoration: none;
    color: #9ca3af;
    font-weight: 500;
    transition: all 0.3s;
    margin-bottom: 8px;
  }

  .nav-item:hover {
    background: #f3f4f6;
    color: #667eea;
  }

  .nav-item.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .nav-item svg, .nav-item .icon {
    width: 22px;
    height: 22px;
    flex-shrink: 0;
  }

  /* Main Content */
  .profile-main {
    flex: 1;
    max-width: 100%;
  }

  .profile-header {
    margin-bottom: 30px;
  }

  .profile-header h1 {
    font-size: 36px;
    color: #1f2937;
    margin: 0 0 8px 0;
    font-weight: 700;
  }

  .profile-header p {
    color: #9ca3af;
    margin: 0;
    font-size: 15px;
  }

  /* Summary Cards */
  .summary-grid {
    display: flex;
    flex-direction: column;
    gap: 24px;
    margin-bottom: 30px;
  }

  .summary-card {
    background: white;
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.08);
    transition: transform 0.3s, box-shadow 0.3s;
    width: 100%;
  }

  .summary-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.15);
  }

  .summary-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .summary-title {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .summary-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .summary-icon svg {
    width: 24px;
    height: 24px;
  }

  .summary-icon.cart {
    background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
    color: #3b82f6;
  }

  .summary-icon.orders {
    background: linear-gradient(135deg, #fef3c7 0%, #fee2e2 100%);
    color: #f59e0b;
  }

  .summary-icon.favorites {
    background: linear-gradient(135deg, #fce7f3 0%, #fee2e2 100%);
    color: #ec4899;
  }

  .summary-title h3 {
    margin: 0;
    font-size: 18px;
    color: #1f2937;
    font-weight: 600;
  }

  .summary-count {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 700;
  }

  .summary-content {
    margin-bottom: 20px;
  }

  .summary-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .summary-item:last-child {
    border-bottom: none;
  }

  .summary-item-name {
    font-size: 14px;
    color: #1f2937;
    font-weight: 500;
  }

  .summary-item-price {
    font-size: 14px;
    color: #667eea;
    font-weight: 600;
  }

  .summary-item-date {
    font-size: 13px;
    color: #9ca3af;
  }

  .summary-empty {
    text-align: center;
    padding: 40px 20px;
    color: #9ca3af;
  }

  .summary-empty-icon {
    width: 48px;
    height: 48px;
    margin: 0 auto 12px;
    opacity: 0.3;
  }

  .summary-empty-icon svg {
    width: 100%;
    height: 100%;
  }

  .view-more-btn {
    display: block;
    width: 100%;
    padding: 12px;
    background: #667eea;
    color: white;
    text-align: center;
    text-decoration: none;
    border-radius: 10px;
    font-weight: 600;
    font-size: 14px;
    transition: transform 0.3s;
  }

  .view-more-btn:hover {
    transform: translateY(-2px);
  }

  /* Edit Profile Form */
  .edit-profile-card {
    background: white;
    border-radius: 16px;
    padding: 32px;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.08);
    margin-top: 24px;
  }

  .edit-profile-card h2 {
    font-size: 24px;
    color: #1f2937;
    margin: 0 0 24px 0;
    font-weight: 700;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-bottom: 24px;
  }

  .form-group-full {
    grid-column: 1 / -1;
  }

  .form-group label {
    display: block;
    font-size: 14px;
    color: #374151;
    font-weight: 600;
    margin-bottom: 8px;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    font-size: 14px;
    color: #1f2937;
    transition: all 0.3s;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 100px;
  }

  .form-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
  }

  .btn {
    padding: 12px 28px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
    border: none;
  }

  .btn-primary {
    background: #667eea;
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .btn-secondary {
    background: #f3f4f6;
    color: #6b7280;
  }

  .btn-secondary:hover {
    background: #e5e7eb;
  }

  /* Remove right sidebar styles */
  .profile-sidebar-right {
    display: none;
  }

  @media (max-width: 768px) {
    .profile-layout {
      flex-direction: column;
    }

    .profile-sidebar {
      width: 100%;
    }

    .sidebar-nav {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .stats-section {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="profile-layout">
  <!-- Left Sidebar -->
  <aside class="profile-sidebar">
    <nav class="sidebar-nav">
      <a href="{% url 'storefront:profile' %}" class="nav-item active">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        Profile
      </a>
      <a href="{% url 'storefront:cart' %}" class="nav-item">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        My Cart
      </a>
      <a href="{% url 'storefront:profile_orders' %}" class="nav-item">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Order History
      </a>
      <a href="{% url 'storefront:profile_favorites' %}" class="nav-item">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
        </svg>
        My Favorites
      </a>
      <a href="{% url 'storefront:profile_edit' %}" class="nav-item">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        Edit Profile
      </a>
      <a href="{% url 'storefront:change_password' %}" class="nav-item">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg>
        Password
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="profile-main">
    <div class="profile-header">
      <h1>My Profile</h1>
      <p>Welcome back, {{ user.get_full_name|default:user.username }}! Manage your account and view your activity.</p>
    </div>

    <!-- Summary Cards -->
    <div class="summary-grid">
      <!-- My Cart Summary -->
      <div class="summary-card">
        <div class="summary-header">
          <div class="summary-title">
            <div class="summary-icon cart">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
            </div>
            <h3>My Cart</h3>
          </div>
          <span class="summary-count">{{ cart_items|length|default:"0" }}</span>
        </div>
        <div class="summary-content">
          {% if cart_items %}
            {% for item in cart_items|slice:":3" %}
            <div class="summary-item">
              <span class="summary-item-name">{{ item.product.name }}</span>
              <span class="summary-item-price">${{ item.product.price }}</span>
            </div>
            {% endfor %}
          {% else %}
            <div class="summary-empty">
              <div class="summary-empty-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
              </div>
              <p>Your cart is empty</p>
            </div>
          {% endif %}
        </div>
        <a href="{% url 'storefront:cart' %}" class="view-more-btn">View Cart</a>
      </div>

      <!-- Order History Summary -->
      <div class="summary-card">
        <div class="summary-header">
          <div class="summary-title">
            <div class="summary-icon orders">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
              </svg>
            </div>
            <h3>Order History</h3>
          </div>
          <span class="summary-count">{{ total_orders|default:"0" }}</span>
        </div>
        <div class="summary-content">
          {% if recent_orders %}
            {% for order in recent_orders|slice:":3" %}
            <div class="summary-item">
              <div>
                <div class="summary-item-name">Order #{{ order.id }}</div>
                <div class="summary-item-date">{{ order.created_at|date:"M d, Y" }}</div>
              </div>
              <span class="summary-item-price">${{ order.total }}</span>
            </div>
            {% endfor %}
          {% else %}
            <div class="summary-empty">
              <div class="summary-empty-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                </svg>
              </div>
              <p>No orders yet</p>
            </div>
          {% endif %}
        </div>
        <a href="{% url 'storefront:profile_orders' %}" class="view-more-btn">View All Orders</a>
      </div>

      <!-- Favorites Summary -->
      <div class="summary-card">
        <div class="summary-header">
          <div class="summary-title">
            <div class="summary-icon favorites">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            </div>
            <h3>My Favorites</h3>
          </div>
          <span class="summary-count">{{ total_favorites|default:"0" }}</span>
        </div>
        <div class="summary-content">
          {% if favorite_products %}
            {% for fav in favorite_products|slice:":3" %}
            <div class="summary-item">
              <span class="summary-item-name">{{ fav.product.name }}</span>
              <span class="summary-item-price">${{ fav.product.price }}</span>
            </div>
            {% endfor %}
          {% else %}
            <div class="summary-empty">
              <div class="summary-empty-icon">
              </div>
              <p>No favourites yet</p>
            </div>
          {% endif %}
        </div>
        <a href="{% url 'storefront:profile_favorites' %}" class="view-more-btn">View Favourites</a>
      </div>
    </div>

    <!-- Edit Profile Form -->
    <div class="edit-profile-card">
      <h2>Edit Profile</h2>
      <form method="POST" action="{% url 'storefront:profile_edit' %}">
        {% csrf_token %}
        <div class="form-grid">
          <div class="form-group">
            <label for="first_name">First Name *</label>
            <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}" required>
          </div>
          
          <div class="form-group">
            <label for="last_name">Last Name *</label>
            <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}" required>
          </div>
          
          <div class="form-group form-group-full">
            <label for="email">Email Address *</label>
            <input type="email" id="email" name="email" value="{{ user.email }}" required>
          </div>
          
          <div class="form-group">
            <label for="username">Username *</label>
            <input type="text" id="username" name="username" value="{{ user.username }}" required>
          </div>
          
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" value="{{ user.customer.phone|default:'' }}" placeholder="+65 1234 5678">
          </div>
          
          <div class="form-group">
            <label for="date_of_birth">Date of Birth</label>
            <input type="date" id="date_of_birth" name="date_of_birth" value="{{ user.customer.date_of_birth|date:'Y-m-d'|default:'' }}">
          </div>
          
          <div class="form-group form-group-full">
            <label for="address">Address</label>
            <textarea id="address" name="address" placeholder="Enter your full address">{{ user.customer.address|default:'' }}</textarea>
          </div>
          
          <div class="form-group">
            <label for="city">City</label>
            <input type="text" id="city" name="city" value="{{ user.customer.city|default:'' }}">
          </div>
          
          <div class="form-group">
            <label for="postal_code">Postal Code</label>
            <input type="text" id="postal_code" name="postal_code" value="{{ user.customer.postal_code|default:'' }}">
          </div>
          
          <div class="form-group">
            <label for="country">Country</label>
            <select id="country" name="country">
              <option value="">Select Country</option>
              <option value="Singapore" {% if user.customer.country == 'Singapore' %}selected{% endif %}>Singapore</option>
              <option value="Malaysia" {% if user.customer.country == 'Malaysia' %}selected{% endif %}>Malaysia</option>
              <option value="Indonesia" {% if user.customer.country == 'Indonesia' %}selected{% endif %}>Indonesia</option>
              <option value="Thailand" {% if user.customer.country == 'Thailand' %}selected{% endif %}>Thailand</option>
              <option value="Philippines" {% if user.customer.country == 'Philippines' %}selected{% endif %}>Philippines</option>
              <option value="Vietnam" {% if user.customer.country == 'Vietnam' %}selected{% endif %}>Vietnam</option>
              <option value="Other" {% if user.customer.country == 'Other' %}selected{% endif %}>Other</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="gender">Gender</label>
            <select id="gender" name="gender">
              <option value="">Prefer not to say</option>
              <option value="Male" {% if user.customer.gender == 'Male' %}selected{% endif %}>Male</option>
              <option value="Female" {% if user.customer.gender == 'Female' %}selected{% endif %}>Female</option>
              <option value="Other" {% if user.customer.gender == 'Other' %}selected{% endif %}>Other</option>
            </select>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="window.location.reload()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </main>
</div>
{% endblock %}
