{% extends "adminpanel/base.html" %}

{% block title %}Low Stock Products{% endblock %}
{% block page_title %}Low Stock Alert{% endblock %}

{% block extra_css %}
<style>
    .alert-summary {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        border: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .alert-icon {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        background: #fffbeb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: #f59e0b;
    }

    .alert-content {
        flex: 1;
    }

    .alert-title {
        font-size: 18px;
        font-weight: 700;
        color: #0f172a;
        margin-bottom: 4px;
    }

    .alert-description {
        font-size: 14px;
        color: #64748b;
    }

    /* Product Table */
    .product-table-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        border: 1px solid #e2e8f0;
        overflow: hidden;
    }

    .table-header {
        padding: 20px 24px;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .table-title {
        font-size: 16px;
        font-weight: 700;
        color: #0f172a;
    }

    .product-table {
        width: 100%;
        border-collapse: collapse;
    }

    .product-table thead {
        background: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
    }

    .product-table th {
        padding: 16px 24px;
        text-align: left;
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .product-table tbody tr {
        border-bottom: 1px solid #e2e8f0;
        transition: background 0.2s ease;
    }

    .product-table tbody tr:hover {
        background: #f8fafc;
    }

    .product-table tbody tr:last-child {
        border-bottom: none;
    }

    .product-table td {
        padding: 20px 24px;
        font-size: 14px;
        color: #0f172a;
    }

    .product-name {
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 4px;
    }

    .product-sku {
        font-size: 12px;
        color: #64748b;
    }

    .category-badge {
        display: inline-block;
        padding: 4px 10px;
        background: #f1f5f9;
        color: #64748b;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
    }

    .stock-status {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
    }

    .stock-status.critical {
        background: #fef2f2;
        color: #dc2626;
    }

    .stock-status.low {
        background: #fffbeb;
        color: #d97706;
    }

    .stock-status i {
        font-size: 10px;
    }

    .price-value {
        font-weight: 600;
        color: #0f172a;
    }

    .action-buttons {
        display: flex;
        gap: 8px;
    }

    .btn-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #e2e8f0;
        background: white;
        color: #64748b;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
    }

    .btn-icon:hover {
        background: #f8fafc;
        color: #0f172a;
        border-color: #cbd5e1;
    }

    .btn-view {
        background: #dbeafe;
        color: #1e40af;
        border-color: #bfdbfe;
    }

    .btn-view:hover {
        background: #bfdbfe;
        color: #1e3a8a;
        border-color: #93c5fd;
    }

    .empty-state {
        text-align: center;
        padding: 60px 24px;
    }

    .empty-state i {
        font-size: 64px;
        color: #e2e8f0;
        margin-bottom: 16px;
    }

    .empty-state h3 {
        font-size: 18px;
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 8px;
    }

    .empty-state p {
        color: #64748b;
        font-size: 14px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Alert Summary -->
<div class="alert-summary">
    <div class="alert-icon">
        <i class="fas fa-exclamation-triangle"></i>
    </div>
    <div class="alert-content">
        <div class="alert-title">{{ products|length }} product{% if products|length != 1 %}s{% endif %} need attention</div>
        <div class="alert-description">Review and restock low inventory items</div>
    </div>
</div>

<!-- Filter Section -->
<div class="filter-section" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
    <form method="get" style="display: flex; gap: 16px; flex-wrap: wrap; align-items: flex-end;">
        <div style="flex: 1; min-width: 200px;">
            <label for="category" style="display: block; font-size: 13px; font-weight: 600; color: #0f172a; margin-bottom: 8px;">
                <i class="fas fa-filter"></i> Filter by Category
            </label>
            <select id="category" name="category" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; color: #0f172a;">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat.id }}" {% if selected_category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div style="flex: 1; min-width: 200px;">
            <label for="sort" style="display: block; font-size: 13px; font-weight: 600; color: #0f172a; margin-bottom: 8px;">
                <i class="fas fa-sort"></i> Sort By
            </label>
            <select id="sort" name="sort" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; color: #0f172a;">
                <option value="stock" {% if sort_by == 'stock' %}selected{% endif %}>Stock (Low-High)</option>
                <option value="-stock" {% if sort_by == '-stock' %}selected{% endif %}>Stock (High-Low)</option>
                <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Name (A-Z)</option>
                <option value="-name" {% if sort_by == '-name' %}selected{% endif %}>Name (Z-A)</option>
                <option value="-price" {% if sort_by == '-price' %}selected{% endif %}>Price (High-Low)</option>
                <option value="price" {% if sort_by == 'price' %}selected{% endif %}>Price (Low-High)</option>
                <option value="-rating" {% if sort_by == '-rating' %}selected{% endif %}>Rating (High-Low)</option>
                <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>Rating (Low-High)</option>
                <option value="-reorder_threshold" {% if sort_by == '-reorder_threshold' %}selected{% endif %}>Reorder Level (High-Low)</option>
                <option value="reorder_threshold" {% if sort_by == 'reorder_threshold' %}selected{% endif %}>Reorder Level (Low-High)</option>
            </select>
        </div>
        
        <button type="submit" style="padding: 10px 24px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; height: 42px;">
            Apply Filters
        </button>
    </form>
</div>

<!-- Product Table -->
{% if products %}
<div class="product-table-container">
    <div class="table-header">
        <h2 class="table-title">Low Stock Products</h2>
    </div>
    
    <table class="product-table">
        <thead>
            <tr>
                <th>Product</th>
                <th>Category</th>
                <th>Stock Status</th>
                <th>Reorder Level</th>
                <th>Price</th>
                <th>Rating</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>
                    <div class="product-name">{{ product.name }}</div>
                    <div class="product-sku">SKU: {{ product.sku }}</div>
                </td>
                <td>
                    <span class="category-badge">{{ product.category.name }}</span>
                    {% if product.subcategory %}
                    <br><small style="color: #6b7280; margin-top: 4px; display: block;">{{ product.subcategory }}</small>
                    {% endif %}
                </td>
                <td>
                    <span class="stock-status {% if product.stock == 0 %}critical{% else %}low{% endif %}">
                        <i class="fas fa-circle"></i>
                        {% if product.stock == 0 %}
                            Out of Stock
                        {% else %}
                            {{ product.stock }} unit{% if product.stock != 1 %}s{% endif %}
                        {% endif %}
                    </span>
                </td>
                <td>{{ product.reorder_threshold }}</td>
                <td>
                    <span class="price-value">${{ product.price }}</span>
                </td>
                <td>
                    <span>{{ product.rating|floatformat:1 }}</span>
                </td>
                <td>
                    <a href="{% url 'adminpanel:product_detail' product.pk %}" class="btn-icon btn-view" title="View Details">
                        <i class="fas fa-eye"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="product-table-container">
    <div class="empty-state">
        <i class="fas fa-check-circle"></i>
        <h3>All Products Well Stocked</h3>
        <p>No products are currently below their reorder threshold</p>
    </div>
</div>
{% endif %}
{% endblock %}
