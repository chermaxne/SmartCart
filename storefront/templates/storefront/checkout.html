{% extends "base.html" %}
{% load static %}

{% block title %}Checkout - AuroraMart{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem 1rem;">
    <h1 class="text-3xl font-bold mb-8">Checkout</h1>

    <form method="POST" action="{% url 'process_checkout' %}">
        {% csrf_token %}
        
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
            <!-- Checkout Form -->
            <div>
                <!-- Shipping Information -->
                <div class="card" style="padding: 1.5rem; margin-bottom: 1.5rem;">
                    <h2 class="text-xl font-bold mb-4">Shipping Information</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">First Name *</label>
                            <input type="text" name="first_name" class="form-input" value="{{ user.first_name }}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name *</label>
                            <input type="text" name="last_name" class="form-input" value="{{ user.last_name }}" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" name="email" class="form-input" value="{{ user.email }}" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <input type="tel" name="phone" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Address *</label>
                        <input type="text" name="address" class="form-input" placeholder="Street address" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">City *</label>
                            <input type="text" name="city" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">State *</label>
                            <input type="text" name="state" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ZIP Code *</label>
                            <input type="text" name="zip_code" class="form-input" required>
                        </div>
                    </div>
                </div>

                <!-- Payment Information -->
                <div class="card" style="padding: 1.5rem; margin-bottom: 1.5rem;">
                    <h2 class="text-xl font-bold mb-4">Payment Information</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Payment Method *</label>
                        <select name="payment_method" class="form-select" required>
                            <option value="credit_card">Credit Card</option>
                            <option value="debit_card">Debit Card</option>
                            <option value="paypal">PayPal</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Card Number *</label>
                        <input type="text" name="card_number" class="form-input" placeholder="1234 5678 9012 3456" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Expiry Month *</label>
                            <input type="text" name="expiry_month" class="form-input" placeholder="MM" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Expiry Year *</label>
                            <input type="text" name="expiry_year" class="form-input" placeholder="YY" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">CVV *</label>
                            <input type="text" name="cvv" class="form-input" placeholder="123" required>
                        </div>
                    </div>
                </div>

                <!-- Order Notes -->
                <div class="card" style="padding: 1.5rem;">
                    <h2 class="text-xl font-bold mb-4">Order Notes (Optional)</h2>
                    <div class="form-group">
                        <textarea name="notes" class="form-textarea" placeholder="Any special instructions for your order?"></textarea>
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div>
                <div class="card" style="padding: 1.5rem; position: sticky; top: 80px;">
                    <h2 class="text-xl font-bold mb-4">Order Summary</h2>
                    
                    <!-- Cart Items -->
                    <div style="max-height: 300px; overflow-y: auto; margin-bottom: 1rem;">
                        {% for item in cart_items %}
                        <div style="display: flex; gap: 1rem; padding: 0.75rem 0; border-bottom: 1px solid var(--border);">
                            <img src="{{ item.product.image_url }}" alt="{{ item.product.name }}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 0.5rem;">
                            <div style="flex: 1;">
                                <p class="font-semibold text-sm">{{ item.product.name }}</p>
                                <p class="text-sm text-gray-600">Qty: {{ item.quantity }}</p>
                                <p class="text-primary font-bold">${{ item.subtotal }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Pricing -->
                    <div style="border-top: 1px solid var(--border); padding-top: 1rem; margin-bottom: 1rem;">
                        <div class="flex justify-between mb-2">
                            <span>Subtotal</span>
                            <span>${{ subtotal }}</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Shipping</span>
                            <span>{% if subtotal >= 50 %}FREE{% else %}$5.99{% endif %}</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Tax</span>
                            <span>${{ tax }}</span>
                        </div>
                    </div>
                    
                    <div class="flex justify-between mb-4" style="border-top: 1px solid var(--border); padding-top: 1rem;">
                        <span class="font-bold text-lg">Total</span>
                        <span class="font-bold text-2xl text-primary">${{ total }}</span>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.125rem;">
                        Place Order
                    </button>

                    <p class="text-sm text-gray-600 text-center" style="margin-top: 1rem;">
                        By placing your order, you agree to our Terms of Service and Privacy Policy
                    </p>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}
